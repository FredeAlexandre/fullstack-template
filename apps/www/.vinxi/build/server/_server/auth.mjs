import{i as ee,b as te}from"./http.mjs";import{defaultTransformer as ne}from"@tanstack/react-router";import re from"fs";import oe from"path";import se from"os";import ae from"crypto";import{drizzle as ie}from"drizzle-orm/node-postgres";import{betterAuth as ce}from"better-auth";import{drizzleAdapter as le}from"better-auth/adapters/drizzle";import{admin as de}from"better-auth/plugins";import{PgUUID as ue,PgChar as fe,PgVarchar as pe,pgTable as D,integer as ve,text as d,timestamp as E,boolean as R}from"drizzle-orm/pg-core";import{getTableColumns as me,is as b}from"drizzle-orm";import{MySqlVarChar as ge,MySqlVarBinary as he,MySqlChar as Ee}from"drizzle-orm/mysql-core";import{SQLiteText as ye}from"drizzle-orm/sqlite-core";import{z as p}from"zod";function Ne(e,n,r){return Object.assign(e,{url:"https://localhost:3000"})}function _e(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function Oe(...e){return e.reduce((n,r)=>{const o=_e(r);for(const[a,s]of o.entries())n.set(a,s);return n},new Headers)}const be=[];function k(e,n){const r=n||e||{};return typeof r.method>"u"&&(r.method="GET"),{options:r,middleware:o=>k(void 0,Object.assign(r,{middleware:o})),validator:o=>k(void 0,Object.assign(r,{validator:o})),handler:(...o)=>{const[a,s]=o;Object.assign(r,{...a,extractedFn:a,serverFn:s}),ee(a.url);const f=[...r.middleware||[],De(r)];return Object.assign(async y=>M(f,"client",{...a,method:r.method,data:y?.data,headers:y?.headers,context:Object.assign({},a)}).then(O=>O.result),{...a,__executeServer:y=>{const O=y instanceof FormData?Te(y):y;return M(f,"server",{...a,...O}).then(T=>({result:T.result,context:T.sendContext}))}})}}}function Te(e){const n=e.get("__TSR_CONTEXT");if(e.delete("__TSR_CONTEXT"),typeof n!="string")return{context:{},data:e};try{return{context:ne.parse(n),data:e}}catch{return{data:e}}}function Ae(e){const n=new Set,r=[],o=a=>{a.forEach(s=>{s.options.middleware&&o(s.options.middleware),n.has(s)||(n.add(s),r.push(s))})};return o(e),r}const q=(e,n,r)=>e({data:n.data,context:n.context,sendContext:n.sendContext,method:n.method,next:o=>{const a={...n.context,...o?.context},s={...n.sendContext,...o?.sendContext??{}},f=Oe(n.headers,o?.headers);return r({method:n.method,data:n.data,context:a,sendContext:s,headers:f,result:o?.result??n.result})}});function we(e,n){if(e==null)return{};if("~standard"in e){const r=e["~standard"].validate(n);if(r instanceof Promise)throw new Error("Async validation not supported");if(r.issues)throw new Error(JSON.stringify(r.issues,void 0,2));return r.value}if("parse"in e)return e.parse(n);if(typeof e=="function")return e(n);throw new Error("Invalid validator type!")}async function M(e,n,r){const o=Ae([...be,...e]),a=async s=>{const f=o.shift();if(!f)return s;f.options.validator&&(n!=="client"||f.options.validateClient)&&(s.data=await we(f.options.validator,s.data));const y=n==="client"?f.options.client:f.options.server;return y?q(y,s,async O=>{if(n==="client"&&f.options.clientAfter){const T=await a(O);return q(f.options.clientAfter,T,x=>x)}return a(O)}):a(s)};return a({...r,headers:r.headers||{},sendContext:r.sendContext||{},context:r.context||{}})}function De(e){return{_types:void 0,options:{validator:e.validator,validateClient:e.validateClient,client:async({next:n,sendContext:r,...o})=>{var a;const s=await((a=e.extractedFn)==null?void 0:a.call(e,{...o,context:r}));return n(s)},server:async({next:n,...r})=>{var o;const a=await((o=e.serverFn)==null?void 0:o.call(e,r));return n({result:a})}}}}var Y={},_={exports:{}};const Ve="dotenv",Ie="16.4.7",xe="Loads environment variables from .env file",$e="lib/main.js",je="lib/main.d.ts",ke={".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},Ce={"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},Se={type:"git",url:"git://github.com/motdotla/dotenv.git"},Fe="https://dotenvx.com",Ke=["dotenv","env",".env","environment","variables","config","settings"],Re="README.md",qe="BSD-2-Clause",Me={"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},Ye={node:">=12"},Le={fs:!1},Ue={name:Ve,version:Ie,description:xe,main:$e,types:je,exports:ke,scripts:Ce,repository:Se,funding:Fe,keywords:Ke,readmeFilename:Re,license:qe,devDependencies:Me,engines:Ye,browser:Le};var L;function Pe(){if(L)return _.exports;L=1;const e=re,n=oe,r=se,o=ae,s=Ue.version,f=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function y(t){const c={};let l=t.toString();l=l.replace(/\r\n?/mg,`
`);let v;for(;(v=f.exec(l))!=null;){const h=v[1];let i=v[2]||"";i=i.trim();const u=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),u==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),c[h]=i}return c}function O(t){const c=F(t),l=g.configDotenv({path:c});if(!l.parsed){const u=new Error(`MISSING_DATA: Cannot parse ${c} for an unknown reason`);throw u.code="MISSING_DATA",u}const v=S(t).split(","),h=v.length;let i;for(let u=0;u<h;u++)try{const m=v[u].trim(),N=z(l,m);i=g.decrypt(N.ciphertext,N.key);break}catch(m){if(u+1>=h)throw m}return g.parse(i)}function T(t){console.log(`[dotenv@${s}][INFO] ${t}`)}function x(t){console.log(`[dotenv@${s}][WARN] ${t}`)}function V(t){console.log(`[dotenv@${s}][DEBUG] ${t}`)}function S(t){return t&&t.DOTENV_KEY&&t.DOTENV_KEY.length>0?t.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function z(t,c){let l;try{l=new URL(c)}catch(m){if(m.code==="ERR_INVALID_URL"){const N=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw N.code="INVALID_DOTENV_KEY",N}throw m}const v=l.password;if(!v){const m=new Error("INVALID_DOTENV_KEY: Missing key part");throw m.code="INVALID_DOTENV_KEY",m}const h=l.searchParams.get("environment");if(!h){const m=new Error("INVALID_DOTENV_KEY: Missing environment part");throw m.code="INVALID_DOTENV_KEY",m}const i=`DOTENV_VAULT_${h.toUpperCase()}`,u=t.parsed[i];if(!u){const m=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw m.code="NOT_FOUND_DOTENV_ENVIRONMENT",m}return{ciphertext:u,key:v}}function F(t){let c=null;if(t&&t.path&&t.path.length>0)if(Array.isArray(t.path))for(const l of t.path)e.existsSync(l)&&(c=l.endsWith(".vault")?l:`${l}.vault`);else c=t.path.endsWith(".vault")?t.path:`${t.path}.vault`;else c=n.resolve(process.cwd(),".env.vault");return e.existsSync(c)?c:null}function K(t){return t[0]==="~"?n.join(r.homedir(),t.slice(1)):t}function W(t){T("Loading env from encrypted .env.vault");const c=g._parseVault(t);let l=process.env;return t&&t.processEnv!=null&&(l=t.processEnv),g.populate(l,c,t),{parsed:c}}function J(t){const c=n.resolve(process.cwd(),".env");let l="utf8";const v=!!(t&&t.debug);t&&t.encoding?l=t.encoding:v&&V("No encoding is specified. UTF-8 is used by default");let h=[c];if(t&&t.path)if(!Array.isArray(t.path))h=[K(t.path)];else{h=[];for(const N of t.path)h.push(K(N))}let i;const u={};for(const N of h)try{const A=g.parse(e.readFileSync(N,{encoding:l}));g.populate(u,A,t)}catch(A){v&&V(`Failed to load ${N} ${A.message}`),i=A}let m=process.env;return t&&t.processEnv!=null&&(m=t.processEnv),g.populate(m,u,t),i?{parsed:u,error:i}:{parsed:u}}function Q(t){if(S(t).length===0)return g.configDotenv(t);const c=F(t);return c?g._configVault(t):(x(`You set DOTENV_KEY but you are missing a .env.vault file at ${c}. Did you forget to build it?`),g.configDotenv(t))}function X(t,c){const l=Buffer.from(c.slice(-64),"hex");let v=Buffer.from(t,"base64");const h=v.subarray(0,12),i=v.subarray(-16);v=v.subarray(12,-16);try{const u=o.createDecipheriv("aes-256-gcm",l,h);return u.setAuthTag(i),`${u.update(v)}${u.final()}`}catch(u){const m=u instanceof RangeError,N=u.message==="Invalid key length",A=u.message==="Unsupported state or unable to authenticate data";if(m||N){const w=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw w.code="INVALID_DOTENV_KEY",w}else if(A){const w=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw w.code="DECRYPTION_FAILED",w}else throw u}}function Z(t,c,l={}){const v=!!(l&&l.debug),h=!!(l&&l.override);if(typeof c!="object"){const i=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw i.code="OBJECT_REQUIRED",i}for(const i of Object.keys(c))Object.prototype.hasOwnProperty.call(t,i)?(h===!0&&(t[i]=c[i]),v&&V(h===!0?`"${i}" is already defined and WAS overwritten`:`"${i}" is already defined and was NOT overwritten`)):t[i]=c[i]}const g={configDotenv:J,_configVault:W,_parseVault:O,config:Q,decrypt:X,parse:y,populate:Z};return _.exports.configDotenv=g.configDotenv,_.exports._configVault=g._configVault,_.exports._parseVault=g._parseVault,_.exports.config=g.config,_.exports.decrypt=g.decrypt,_.exports.parse=g.parse,_.exports.populate=g.populate,_.exports=g,_.exports}var $,U;function Ge(){if(U)return $;U=1;const e={};return process.env.DOTENV_CONFIG_ENCODING!=null&&(e.encoding=process.env.DOTENV_CONFIG_ENCODING),process.env.DOTENV_CONFIG_PATH!=null&&(e.path=process.env.DOTENV_CONFIG_PATH),process.env.DOTENV_CONFIG_DEBUG!=null&&(e.debug=process.env.DOTENV_CONFIG_DEBUG),process.env.DOTENV_CONFIG_OVERRIDE!=null&&(e.override=process.env.DOTENV_CONFIG_OVERRIDE),process.env.DOTENV_CONFIG_DOTENV_KEY!=null&&(e.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY),$=e,$}var j,P;function Be(){if(P)return j;P=1;const e=/^dotenv_config_(encoding|path|debug|override|DOTENV_KEY)=(.+)$/;return j=function(r){return r.reduce(function(o,a){const s=a.match(e);return s&&(o[s[1]]=s[2]),o},{})},j}var G;function He(){return G||(G=1,function(){Pe().config(Object.assign({},Ge(),Be()(process.argv)))}()),Y}He();if(!process.env.DATABASE_URL)throw new Error("Missing DATABASE_URL is required");const ze=ie(process.env.DATABASE_URL),We=p.union([p.string(),p.number(),p.boolean(),p.null()]),C=p.lazy(()=>p.union([We,p.array(C),p.record(C)]));function Je(e,n){const r=me(e),o=Object.entries(r);let a=Object.fromEntries(o.map(([s,f])=>[s,B(f)]));n&&(a=Object.assign(a,Object.fromEntries(Object.entries(n).map(([s,f])=>[s,typeof f=="function"?f(a):f]))));for(const[s,f]of o)f.notNull?f.hasDefault&&(a[s]=a[s].optional()):a[s]=a[s].nullable().optional();return p.object(a)}function B(e){let n;if(function(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}(e)&&(n=e.enumValues.length?p.enum(e.enumValues):p.string()),!n){if(b(e,ue))n=p.string().uuid();else if(e.dataType==="custom")n=p.any();else if(e.dataType==="json")n=C;else if(e.dataType==="array")n=p.array(B(e.baseColumn));else if(e.dataType==="number")n=p.number();else if(e.dataType==="bigint")n=p.bigint();else if(e.dataType==="boolean")n=p.boolean();else if(e.dataType==="date")n=p.date();else if(e.dataType==="string"){let r=p.string();(b(e,fe)||b(e,pe)||b(e,ge)||b(e,he)||b(e,Ee)||b(e,ye))&&typeof e.length=="number"&&(r=r.max(e.length)),n=r}}return n||(n=p.any()),n}const H=D("project",{id:ve("id").primaryKey().generatedAlwaysAsIdentity(),name:d("name").notNull(),userId:d("userId").notNull().references(()=>I.id),description:d("description"),createdAt:E("createdAt").notNull().defaultNow(),updatedAt:E("updatedAt").notNull().defaultNow()}),Qe=Je(H,{name:p.string().max(256),userId:p.string(),description:p.string().max(1024).optional()}).omit({id:!0,createdAt:!0,updatedAt:!0}),I=D("user",{id:d("id").primaryKey(),name:d("name").notNull(),email:d("email").notNull().unique(),emailVerified:R("emailVerified").notNull(),image:d("image"),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull(),role:d("role"),banned:R("banned"),banReason:d("banReason"),banExpires:E("banExpires")}),Xe=D("session",{id:d("id").primaryKey(),expiresAt:E("expiresAt").notNull(),token:d("token").notNull().unique(),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull(),ipAddress:d("ipAddress"),userAgent:d("userAgent"),userId:d("userId").notNull().references(()=>I.id),impersonatedBy:d("impersonatedBy")}),Ze=D("account",{id:d("id").primaryKey(),accountId:d("accountId").notNull(),providerId:d("providerId").notNull(),userId:d("userId").notNull().references(()=>I.id),accessToken:d("accessToken"),refreshToken:d("refreshToken"),idToken:d("idToken"),accessTokenExpiresAt:E("accessTokenExpiresAt"),refreshTokenExpiresAt:E("refreshTokenExpiresAt"),scope:d("scope"),password:d("password"),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull()}),et=D("verification",{id:d("id").primaryKey(),identifier:d("identifier").notNull(),value:d("value").notNull(),expiresAt:E("expiresAt").notNull(),createdAt:E("createdAt"),updatedAt:E("updatedAt")}),tt=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectSchema:Qe,account:Ze,project:H,session:Xe,user:I,verification:et},Symbol.toStringTag,{value:"Module"})),nt=ce({database:le(ze,{provider:"pg",schema:tt}),plugins:[de()],emailAndPassword:{enabled:!0,sendResetPassword:async({user:e,url:n,token:r},o)=>{console.log(`[FAKE] Reseting password to ${e.email} with token ${r} go to this url ${n}`)}},emailVerification:{sendOnSignUp:!0,requireEmailVerification:!0,sendVerificationEmail:async({user:e,url:n,token:r},o)=>{console.log(`[FAKE] Sending email to ${e.email} with token ${r} go to this url ${n}`)}}}),rt=k({method:"GET"}).handler(Ne(ot),async()=>{const e=te();return await nt.api.getSession({headers:e.headers})});function ot(e){return rt.__executeServer(e)}export{ot as $,Qe as C,Ne as a,k as c,ze as d,rt as f,H as p};
