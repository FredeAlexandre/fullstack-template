import{defaultTransformer as i,isRedirect as f,isNotFound as v}from"@tanstack/react-router";import{t as R,i as h,g as S,a as F}from"./http.mjs";import{eventHandler as N}from"h3";import"node:async_hooks";function T(e){return globalThis.MANIFEST[e]}const b=N(C);async function C(e){return j(R(e))}async function j(e,c){var r,d;const p=e.method,y=new URL(e.url,"http://localhost:3000"),o=Object.fromEntries(y.searchParams.entries()),s=o._serverFnId,u=o._serverFnName;if(!s||!u)throw new Error("Invalid request");h(typeof s=="string");const g=(d=await((r=T("server").chunks[s])==null?void 0:r.import()))==null?void 0:d[u],a=await(async()=>{try{const t=await(async()=>{var l;if((l=e.headers.get("Content-Type"))!=null&&l.includes("multipart/form-data"))return h(p.toLowerCase()!=="get","GET requests with FormData payloads are not supported"),await e.formData();if(p.toLowerCase()==="get")return o.payload?i.parse(o.payload):void 0;const w=await e.text();return i.parse(w)})(),n=await g(t);return n instanceof Response?n:f(n)||v(n)?m(n):new Response(n!==void 0?i.stringify(n):void 0,{status:S(F()),headers:{"Content-Type":"application/json"}})}catch(t){return t instanceof Response?t:f(t)||v(t)?m(t):(console.error("Server Fn Error!"),console.error(t),console.info(),new Response(JSON.stringify(t),{status:500,headers:{"Content-Type":"application/json"}}))}})();if(a.headers.get("Content-Type")==="application/json"){const n=await a.clone().text();n&&JSON.stringify(JSON.parse(n))}return a}function m(e){const{headers:c,...r}=e;return new Response(JSON.stringify(r),{status:200,headers:{"Content-Type":"application/json",...c||{}}})}export{b as default};
