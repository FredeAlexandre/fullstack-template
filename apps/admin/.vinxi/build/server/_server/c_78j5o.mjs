import{i as ne,b as re}from"./http.mjs";import{defaultTransformer as oe}from"@tanstack/react-router";import se from"fs";import ae from"path";import ie from"os";import ce from"crypto";import{drizzle as le}from"drizzle-orm/node-postgres";import{betterAuth as de}from"better-auth";import{drizzleAdapter as ue}from"better-auth/adapters/drizzle";import{admin as fe}from"better-auth/plugins";import{PgUUID as pe,PgChar as ve,PgVarchar as me,pgTable as V,integer as ge,text as d,timestamp as E,boolean as R}from"drizzle-orm/pg-core";import{getTableColumns as he,is as b,eq as Ee}from"drizzle-orm";import{MySqlVarChar as ye,MySqlVarBinary as _e,MySqlChar as Ne}from"drizzle-orm/mysql-core";import{SQLiteText as Oe}from"drizzle-orm/sqlite-core";import{z as p}from"zod";import"h3";import"node:async_hooks";function B(e,n,r){return Object.assign(e,{url:"https://localhost:3000"})}function be(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function Te(...e){return e.reduce((n,r)=>{const o=be(r);for(const[a,s]of o.entries())n.set(a,s);return n},new Headers)}const Ae=[];function x(e,n){const r=n||e||{};return typeof r.method>"u"&&(r.method="GET"),{options:r,middleware:o=>x(void 0,Object.assign(r,{middleware:o})),validator:o=>x(void 0,Object.assign(r,{validator:o})),handler:(...o)=>{const[a,s]=o;Object.assign(r,{...a,extractedFn:a,serverFn:s}),ne(a.url);const f=[...r.middleware||[],Ie(r)];return Object.assign(async y=>M(f,"client",{...a,method:r.method,data:y?.data,headers:y?.headers,context:Object.assign({},a)}).then(O=>O.result),{...a,__executeServer:y=>{const O=y instanceof FormData?we(y):y;return M(f,"server",{...a,...O}).then(T=>({result:T.result,context:T.sendContext}))}})}}}function we(e){const n=e.get("__TSR_CONTEXT");if(e.delete("__TSR_CONTEXT"),typeof n!="string")return{context:{},data:e};try{return{context:oe.parse(n),data:e}}catch{return{data:e}}}function De(e){const n=new Set,r=[],o=a=>{a.forEach(s=>{s.options.middleware&&o(s.options.middleware),n.has(s)||(n.add(s),r.push(s))})};return o(e),r}const q=(e,n,r)=>e({data:n.data,context:n.context,sendContext:n.sendContext,method:n.method,next:o=>{const a={...n.context,...o?.context},s={...n.sendContext,...o?.sendContext??{}},f=Te(n.headers,o?.headers);return r({method:n.method,data:n.data,context:a,sendContext:s,headers:f,result:o?.result??n.result})}});function Ve(e,n){if(e==null)return{};if("~standard"in e){const r=e["~standard"].validate(n);if(r instanceof Promise)throw new Error("Async validation not supported");if(r.issues)throw new Error(JSON.stringify(r.issues,void 0,2));return r.value}if("parse"in e)return e.parse(n);if(typeof e=="function")return e(n);throw new Error("Invalid validator type!")}async function M(e,n,r){const o=De([...Ae,...e]),a=async s=>{const f=o.shift();if(!f)return s;f.options.validator&&(n!=="client"||f.options.validateClient)&&(s.data=await Ve(f.options.validator,s.data));const y=n==="client"?f.options.client:f.options.server;return y?q(y,s,async O=>{if(n==="client"&&f.options.clientAfter){const T=await a(O);return q(f.options.clientAfter,T,$=>$)}return a(O)}):a(s)};return a({...r,headers:r.headers||{},sendContext:r.sendContext||{},context:r.context||{}})}function Ie(e){return{_types:void 0,options:{validator:e.validator,validateClient:e.validateClient,client:async({next:n,sendContext:r,...o})=>{var a;const s=await((a=e.extractedFn)==null?void 0:a.call(e,{...o,context:r}));return n(s)},server:async({next:n,...r})=>{var o;const a=await((o=e.serverFn)==null?void 0:o.call(e,r));return n({result:a})}}}}var L={},N={exports:{}};const xe="dotenv",$e="16.4.7",je="Loads environment variables from .env file",ke="lib/main.js",Ce="lib/main.d.ts",Se={".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},Fe={"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run --show-full-coverage --timeout=60000 --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},Ke={type:"git",url:"git://github.com/motdotla/dotenv.git"},Re="https://dotenvx.com",qe=["dotenv","env",".env","environment","variables","config","settings"],Me="README.md",Le="BSD-2-Clause",Ye={"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},Ue={node:">=12"},Ge={fs:!1},Pe={name:xe,version:$e,description:je,main:ke,types:Ce,exports:Se,scripts:Fe,repository:Ke,funding:Re,keywords:qe,readmeFilename:Me,license:Le,devDependencies:Ye,engines:Ue,browser:Ge};var Y;function Be(){if(Y)return N.exports;Y=1;const e=se,n=ae,r=ie,o=ce,s=Pe.version,f=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function y(t){const c={};let l=t.toString();l=l.replace(/\r\n?/mg,`
`);let v;for(;(v=f.exec(l))!=null;){const h=v[1];let i=v[2]||"";i=i.trim();const u=i[0];i=i.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),u==='"'&&(i=i.replace(/\\n/g,`
`),i=i.replace(/\\r/g,"\r")),c[h]=i}return c}function O(t){const c=F(t),l=g.configDotenv({path:c});if(!l.parsed){const u=new Error(`MISSING_DATA: Cannot parse ${c} for an unknown reason`);throw u.code="MISSING_DATA",u}const v=S(t).split(","),h=v.length;let i;for(let u=0;u<h;u++)try{const m=v[u].trim(),_=J(l,m);i=g.decrypt(_.ciphertext,_.key);break}catch(m){if(u+1>=h)throw m}return g.parse(i)}function T(t){console.log(`[dotenv@${s}][INFO] ${t}`)}function $(t){console.log(`[dotenv@${s}][WARN] ${t}`)}function I(t){console.log(`[dotenv@${s}][DEBUG] ${t}`)}function S(t){return t&&t.DOTENV_KEY&&t.DOTENV_KEY.length>0?t.DOTENV_KEY:process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0?process.env.DOTENV_KEY:""}function J(t,c){let l;try{l=new URL(c)}catch(m){if(m.code==="ERR_INVALID_URL"){const _=new Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw _.code="INVALID_DOTENV_KEY",_}throw m}const v=l.password;if(!v){const m=new Error("INVALID_DOTENV_KEY: Missing key part");throw m.code="INVALID_DOTENV_KEY",m}const h=l.searchParams.get("environment");if(!h){const m=new Error("INVALID_DOTENV_KEY: Missing environment part");throw m.code="INVALID_DOTENV_KEY",m}const i=`DOTENV_VAULT_${h.toUpperCase()}`,u=t.parsed[i];if(!u){const m=new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${i} in your .env.vault file.`);throw m.code="NOT_FOUND_DOTENV_ENVIRONMENT",m}return{ciphertext:u,key:v}}function F(t){let c=null;if(t&&t.path&&t.path.length>0)if(Array.isArray(t.path))for(const l of t.path)e.existsSync(l)&&(c=l.endsWith(".vault")?l:`${l}.vault`);else c=t.path.endsWith(".vault")?t.path:`${t.path}.vault`;else c=n.resolve(process.cwd(),".env.vault");return e.existsSync(c)?c:null}function K(t){return t[0]==="~"?n.join(r.homedir(),t.slice(1)):t}function Q(t){T("Loading env from encrypted .env.vault");const c=g._parseVault(t);let l=process.env;return t&&t.processEnv!=null&&(l=t.processEnv),g.populate(l,c,t),{parsed:c}}function X(t){const c=n.resolve(process.cwd(),".env");let l="utf8";const v=!!(t&&t.debug);t&&t.encoding?l=t.encoding:v&&I("No encoding is specified. UTF-8 is used by default");let h=[c];if(t&&t.path)if(!Array.isArray(t.path))h=[K(t.path)];else{h=[];for(const _ of t.path)h.push(K(_))}let i;const u={};for(const _ of h)try{const A=g.parse(e.readFileSync(_,{encoding:l}));g.populate(u,A,t)}catch(A){v&&I(`Failed to load ${_} ${A.message}`),i=A}let m=process.env;return t&&t.processEnv!=null&&(m=t.processEnv),g.populate(m,u,t),i?{parsed:u,error:i}:{parsed:u}}function Z(t){if(S(t).length===0)return g.configDotenv(t);const c=F(t);return c?g._configVault(t):($(`You set DOTENV_KEY but you are missing a .env.vault file at ${c}. Did you forget to build it?`),g.configDotenv(t))}function ee(t,c){const l=Buffer.from(c.slice(-64),"hex");let v=Buffer.from(t,"base64");const h=v.subarray(0,12),i=v.subarray(-16);v=v.subarray(12,-16);try{const u=o.createDecipheriv("aes-256-gcm",l,h);return u.setAuthTag(i),`${u.update(v)}${u.final()}`}catch(u){const m=u instanceof RangeError,_=u.message==="Invalid key length",A=u.message==="Unsupported state or unable to authenticate data";if(m||_){const D=new Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw D.code="INVALID_DOTENV_KEY",D}else if(A){const D=new Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw D.code="DECRYPTION_FAILED",D}else throw u}}function te(t,c,l={}){const v=!!(l&&l.debug),h=!!(l&&l.override);if(typeof c!="object"){const i=new Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw i.code="OBJECT_REQUIRED",i}for(const i of Object.keys(c))Object.prototype.hasOwnProperty.call(t,i)?(h===!0&&(t[i]=c[i]),v&&I(h===!0?`"${i}" is already defined and WAS overwritten`:`"${i}" is already defined and was NOT overwritten`)):t[i]=c[i]}const g={configDotenv:X,_configVault:Q,_parseVault:O,config:Z,decrypt:ee,parse:y,populate:te};return N.exports.configDotenv=g.configDotenv,N.exports._configVault=g._configVault,N.exports._parseVault=g._parseVault,N.exports.config=g.config,N.exports.decrypt=g.decrypt,N.exports.parse=g.parse,N.exports.populate=g.populate,N.exports=g,N.exports}var j,U;function He(){if(U)return j;U=1;const e={};return process.env.DOTENV_CONFIG_ENCODING!=null&&(e.encoding=process.env.DOTENV_CONFIG_ENCODING),process.env.DOTENV_CONFIG_PATH!=null&&(e.path=process.env.DOTENV_CONFIG_PATH),process.env.DOTENV_CONFIG_DEBUG!=null&&(e.debug=process.env.DOTENV_CONFIG_DEBUG),process.env.DOTENV_CONFIG_OVERRIDE!=null&&(e.override=process.env.DOTENV_CONFIG_OVERRIDE),process.env.DOTENV_CONFIG_DOTENV_KEY!=null&&(e.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY),j=e,j}var k,G;function ze(){if(G)return k;G=1;const e=/^dotenv_config_(encoding|path|debug|override|DOTENV_KEY)=(.+)$/;return k=function(r){return r.reduce(function(o,a){const s=a.match(e);return s&&(o[s[1]]=s[2]),o},{})},k}var P;function We(){return P||(P=1,function(){Be().config(Object.assign({},He(),ze()(process.argv)))}()),L}We();if(!process.env.DATABASE_URL)throw new Error("Missing DATABASE_URL is required");const H=le(process.env.DATABASE_URL),Je=p.union([p.string(),p.number(),p.boolean(),p.null()]),C=p.lazy(()=>p.union([Je,p.array(C),p.record(C)]));function Qe(e,n){const r=he(e),o=Object.entries(r);let a=Object.fromEntries(o.map(([s,f])=>[s,z(f)]));n&&(a=Object.assign(a,Object.fromEntries(Object.entries(n).map(([s,f])=>[s,typeof f=="function"?f(a):f]))));for(const[s,f]of o)f.notNull?f.hasDefault&&(a[s]=a[s].optional()):a[s]=a[s].nullable().optional();return p.object(a)}function z(e){let n;if(function(r){return"enumValues"in r&&Array.isArray(r.enumValues)&&r.enumValues.length>0}(e)&&(n=e.enumValues.length?p.enum(e.enumValues):p.string()),!n){if(b(e,pe))n=p.string().uuid();else if(e.dataType==="custom")n=p.any();else if(e.dataType==="json")n=C;else if(e.dataType==="array")n=p.array(z(e.baseColumn));else if(e.dataType==="number")n=p.number();else if(e.dataType==="bigint")n=p.bigint();else if(e.dataType==="boolean")n=p.boolean();else if(e.dataType==="date")n=p.date();else if(e.dataType==="string"){let r=p.string();(b(e,ve)||b(e,me)||b(e,ye)||b(e,_e)||b(e,Ne)||b(e,Oe))&&typeof e.length=="number"&&(r=r.max(e.length)),n=r}}return n||(n=p.any()),n}const W=V("project",{id:ge("id").primaryKey().generatedAlwaysAsIdentity(),name:d("name").notNull(),userId:d("userId").notNull().references(()=>w.id),description:d("description"),createdAt:E("createdAt").notNull().defaultNow(),updatedAt:E("updatedAt").notNull().defaultNow()}),Xe=Qe(W,{name:p.string().max(256),userId:p.string(),description:p.string().max(1024).optional()}).omit({id:!0,createdAt:!0,updatedAt:!0}),w=V("user",{id:d("id").primaryKey(),name:d("name").notNull(),email:d("email").notNull().unique(),emailVerified:R("emailVerified").notNull(),image:d("image"),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull(),role:d("role"),banned:R("banned"),banReason:d("banReason"),banExpires:E("banExpires")}),Ze=V("session",{id:d("id").primaryKey(),expiresAt:E("expiresAt").notNull(),token:d("token").notNull().unique(),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull(),ipAddress:d("ipAddress"),userAgent:d("userAgent"),userId:d("userId").notNull().references(()=>w.id),impersonatedBy:d("impersonatedBy")}),et=V("account",{id:d("id").primaryKey(),accountId:d("accountId").notNull(),providerId:d("providerId").notNull(),userId:d("userId").notNull().references(()=>w.id),accessToken:d("accessToken"),refreshToken:d("refreshToken"),idToken:d("idToken"),accessTokenExpiresAt:E("accessTokenExpiresAt"),refreshTokenExpiresAt:E("refreshTokenExpiresAt"),scope:d("scope"),password:d("password"),createdAt:E("createdAt").notNull(),updatedAt:E("updatedAt").notNull()}),tt=V("verification",{id:d("id").primaryKey(),identifier:d("identifier").notNull(),value:d("value").notNull(),expiresAt:E("expiresAt").notNull(),createdAt:E("createdAt"),updatedAt:E("updatedAt")}),nt=Object.freeze(Object.defineProperty({__proto__:null,CreateProjectSchema:Xe,account:et,project:W,session:Ze,user:w,verification:tt},Symbol.toStringTag,{value:"Module"})),rt=de({database:ue(H,{provider:"pg",schema:nt}),plugins:[fe()],emailAndPassword:{enabled:!0,sendResetPassword:async({user:e,url:n,token:r},o)=>{console.log(`[FAKE] Reseting password to ${e.email} with token ${r} go to this url ${n}`)}},emailVerification:{sendOnSignUp:!0,requireEmailVerification:!0,sendVerificationEmail:async({user:e,url:n,token:r},o)=>{console.log(`[FAKE] Sending email to ${e.email} with token ${r} go to this url ${n}`)}}}),ot=x({method:"GET"}).handler(B(at),async()=>{const e=re();return await rt.api.getSession({headers:e.headers})}),st=x({method:"GET"}).handler(B(it),async()=>(await H.select().from(w).where(Ee(w.role,"admin")).limit(1)).length===0);function at(e){return ot.__executeServer(e)}function it(e){return st.__executeServer(e)}export{at as $$function0,it as $$function1,ot as fetchUser,st as isFirstLaunch};
